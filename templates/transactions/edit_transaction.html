{% extends 'base.html' %}

{% block title %}Edit Transaction{% endblock %}

{% block content %}
<h2>Edit Transaction</h2>
<form id="edit-transaction-form">
    <select id="transaction_type">
        <option value="income">Income</option>
        <option value="expense">Expense</option>
    </select>
    <input type="number" id="amount" placeholder="Amount">
    <textarea id="description" placeholder="Description"></textarea>
    <input type="date" id="date">
    <button type="submit">Save Changes</button>
</form>

<script>
    const transactionId = // получаем ID транзакции из URL или как-то иначе

    // Получить существующие данные транзакции
    fetch(`/api/transactions/${transactionId}/`, {
        headers: {
            'Authorization': 'Token ' + localStorage.getItem('token')
        }
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('transaction_type').value = data.transaction_type;
        document.getElementById('amount').value = data.amount;
        document.getElementById('description').value = data.description;
        document.getElementById('date').value = data.date;
    });

    // Сохранение изменений
    document.getElementById('edit-transaction-form').addEventListener('submit', function(event) {
        event.preventDefault();

        const transactionType = document.getElementById('transaction_type').value;
        const amount = document.getElementById('amount').value;
        const description = document.getElementById('description').value;
        const date = document.getElementById('date').value;

        fetch(`/api/transactions/${transactionId}/`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Token ' + localStorage.getItem('token')
            },
            body: JSON.stringify({
                transaction_type: transactionType,
                amount: amount,
                description: description,
                date: date
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.id) {
                window.location.href = '/';
            } else {
                alert('Failed to edit transaction');
            }
        });
    });
</script>
{% endblock %}
